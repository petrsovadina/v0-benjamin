{
  "file_path": "backend/tests/test_parsers.py",
  "main_branch_history": [],
  "task_views": {
    "001-complete-guidelines-rag-pdf-import": {
      "task_id": "001-complete-guidelines-rag-pdf-import",
      "branch_point": {
        "commit_hash": "d092d181e511c0ef7a36dcfd2dfe3f083cbae73e",
        "content": "",
        "timestamp": "2025-12-25T01:35:52.079046"
      },
      "worktree_state": {
        "content": "import pytest\nfrom unittest.mock import MagicMock, patch, mock_open\nfrom backend.data_processing.parsers.spc_pil_parser import SpcPilParser\n\n@pytest.fixture\ndef parser():\n    return SpcPilParser()\n\ndef test_process_drugs(parser):\n    drugs = [{\"sukl_code\": \"0001\", \"name\": \"TEST DRUG\"}]\n    result = parser.process_drugs(drugs)\n    \n    assert \"spc\" in result\n    assert \"pil\" in result\n    assert len(result[\"spc\"]) == 1\n    assert result[\"spc\"][0][\"sukl_code\"] == \"0001\"\n    assert \"https://www.sukl.cz/modules/medication/detail.php?code=0001\" in result[\"spc\"][0][\"document_url\"]\n\nimport sys\nfrom unittest.mock import MagicMock, patch\n\n@pytest.fixture\ndef mock_pdfplumber_module():\n    mock_module = MagicMock()\n    return mock_module\n\ndef test_extract_text_from_pdf_success(parser, mock_pdfplumber_module):\n    # Setup mock PDF structure\n    mock_page = MagicMock()\n    mock_page.extract_text.return_value = \"Extracted text page 1\"\n    \n    mock_pdf = MagicMock()\n    mock_pdf.pages = [mock_page, mock_page]\n    mock_pdf.__enter__.return_value = mock_pdf \n    \n    mock_pdfplumber_module.open.return_value = mock_pdf\n    \n    # Patch sys.modules to return our mock when 'pdfplumber' is imported\n    with patch.dict(sys.modules, {'pdfplumber': mock_pdfplumber_module}):\n        text = parser.extract_text_from_pdf(\"fake_path.pdf\")\n    \n    # Verify\n    assert \"Extracted text page 1\" in text\n    assert text.count(\"Extracted text page 1\") == 2\n    mock_pdfplumber_module.open.assert_called_with(\"fake_path.pdf\")\n\ndef test_extract_text_from_pdf_error(parser, mock_pdfplumber_module):\n    # Setup mock to raise exception\n    mock_pdfplumber_module.open.side_effect = Exception(\"PDF Corrupt\")\n    \n    with patch.dict(sys.modules, {'pdfplumber': mock_pdfplumber_module}):\n        text = parser.extract_text_from_pdf(\"bad_file.pdf\")\n    \n    # Verify\n    assert text == \"\"\n",
        "last_modified": "2025-12-25T21:22:15.396630"
      },
      "task_intent": {
        "title": "001-complete-guidelines-rag-pdf-import",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2025-12-25T01:36:14.332120",
  "last_updated": "2025-12-25T01:36:14.345421"
}