{
  "file_path": "backend/verify_prompts.py",
  "main_branch_history": [],
  "task_views": {
    "001-complete-guidelines-rag-pdf-import": {
      "task_id": "001-complete-guidelines-rag-pdf-import",
      "branch_point": {
        "commit_hash": "d092d181e511c0ef7a36dcfd2dfe3f083cbae73e",
        "content": "",
        "timestamp": "2025-12-25T01:35:52.079046"
      },
      "worktree_state": {
        "content": "import asyncio\nimport os\nimport sys\nfrom pathlib import Path\n\n# Add backend directory to path\nsys.path.append(str(Path(__file__).resolve().parent.parent))\n\nfrom backend.agent_graph import app\nfrom langchain_core.messages import HumanMessage\n\nasync def test_agent():\n    print(\"--- \ud83e\uddea STARTING SYSTEM PROMPT VERIFICATION ---\\n\")\n\n    # 1. Test: Medical Query (Should be answered with citations)\n    print(\"\ud83d\udccb TEST 1: Medical Query (Diabetes)\")\n    medical_query = \"Jak\u00e9 jsou doporu\u010den\u00e9 l\u00e9ky pro diabetes 2. typu dle \u010desk\u00fdch guidelines?\"\n    print(f\"User: {medical_query}\")\n    \n    try:\n        response = await app.ainvoke({\"messages\": [HumanMessage(content=medical_query)]})\n        last_message = response[\"messages\"][-1].content\n        print(f\"\\n\ud83e\udd16 Agent:\\n{last_message[:500]}...\") # Print first 500 chars\n\n        # Verification\n        validation_errors = []\n        if \"[S\u00daKL\" not in last_message and \"[SPC\" not in last_message and \"guidelines\" not in last_message.lower():\n            validation_errors.append(\"\u274c Missing citations/references\")\n        \n        if \"http\" not in last_message:\n            validation_errors.append(\"\u274c Missing URLs\")\n\n        if not validation_errors:\n            print(\"\\n\u2705 TEST 1 PASSED: References found.\")\n        else:\n            print(f\"\\n\u26a0\ufe0f TEST 1 WARNINGS: {', '.join(validation_errors)}\")\n\n    except Exception as e:\n        print(f\"\\n\u274c TEST 1 FAILED with Error: {e}\")\n\n\n    print(\"\\n--------------------------------------------------\\n\")\n\n    # 2. Test: Off-topic Query (Should be rejected)\n    print(\"\ud83d\udeab TEST 2: Off-topic Query (Cooking)\")\n    off_topic_query = \"Jak\u00fd je nejlep\u0161\u00ed recept na sv\u00ed\u010dkovou?\"\n    print(f\"User: {off_topic_query}\")\n\n    try:\n        response = await app.ainvoke({\"messages\": [HumanMessage(content=off_topic_query)]})\n        last_message = response[\"messages\"][-1].content\n        print(f\"\\n\ud83e\udd16 Agent:\\n{last_message}\")\n\n        # Verification\n        if \"nemohu\" in last_message.lower() or \"jsem klinick\u00fd\" in last_message.lower() or \"nesouvis\u00ed s medic\u00ednou\" in last_message.lower():\n             print(\"\\n\u2705 TEST 2 PASSED: Query rejected.\")\n        else:\n             print(\"\\n\u26a0\ufe0f TEST 2 WARNING: Agent might not have rejected the query properly.\")\n\n    except Exception as e:\n        print(f\"\\n\u274c TEST 2 FAILED with Error: {e}\")\n\n    print(\"\\n--- \ud83c\udfc1 VERIFICATION COMPLETE ---\")\n\nif __name__ == \"__main__\":\n    asyncio.run(test_agent())\n",
        "last_modified": "2025-12-25T21:22:15.405685"
      },
      "task_intent": {
        "title": "001-complete-guidelines-rag-pdf-import",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2025-12-25T01:36:14.418966",
  "last_updated": "2025-12-25T01:36:14.432304"
}