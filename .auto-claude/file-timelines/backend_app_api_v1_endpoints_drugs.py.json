{
  "file_path": "backend/app/api/v1/endpoints/drugs.py",
  "main_branch_history": [],
  "task_views": {
    "001-complete-guidelines-rag-pdf-import": {
      "task_id": "001-complete-guidelines-rag-pdf-import",
      "branch_point": {
        "commit_hash": "d092d181e511c0ef7a36dcfd2dfe3f083cbae73e",
        "content": "",
        "timestamp": "2025-12-25T01:35:52.079046"
      },
      "worktree_state": {
        "content": "from fastapi import APIRouter, HTTPException, Depends\nfrom backend.app.api.v1.deps import get_current_user\nfrom backend.app.services.search_service import search_service\nfrom typing import List, Dict, Any\nfrom pydantic import BaseModel\nfrom backend.pipeline.retrievers.vzp_retriever import VzpRetriever\nfrom backend.services.logger import get_logger\n\nlogger = get_logger(__name__)\nrouter = APIRouter()\n\nclass VzpSearchRequest(BaseModel):\n    query: str\n\n@router.get(\"/search\", response_model=List[Dict[str, Any]])\nasync def search_drugs(\n    q: str,\n    current_user: Dict[str, Any] = Depends(get_current_user)\n):\n    \"\"\"\n    Search for drugs by name or active substance.\n    \"\"\"\n    if len(q) < 2:\n         raise HTTPException(status_code=400, detail=\"Query too short\")\n    return await search_service.search_drugs(q)\n\n@router.post(\"/vzp-search\")\nasync def vzp_search_endpoint(\n    body: VzpSearchRequest,\n    current_user: Dict[str, Any] = Depends(get_current_user)\n):\n    \"\"\"\n    Search for VZP pricing data.\n    \"\"\"\n    try:\n        retriever = VzpRetriever()\n        results = await retriever.search_drugs_with_pricing(body.query)\n        return {\"results\": results, \"source\": \"sukl-db\"}\n    except Exception as e:\n        logger.error(\"Error processing VZP search\", error=e)\n        return {\"results\": [], \"error\": str(e)}\n\n@router.get(\"/{sukl_code}\")\nasync def get_drug_detail(\n    sukl_code: str,\n    current_user: Dict[str, Any] = Depends(get_current_user)\n):\n    \"\"\"\n    Get detailed information about a specific drug.\n    \"\"\"\n    # We can use search_service or direct db access logic\n    # Adding a specific method to search_service would be cleaner, but for now accessing via helper:\n    from app.core.database import get_supabase_client\n    supabase = get_supabase_client()\n    \n    res = supabase.table(\"drugs\").select(\"*\").eq(\"sukl_code\", sukl_code).execute()\n    if not res.data:\n        raise HTTPException(status_code=404, detail=\"Drug not found\")\n        \n    return res.data[0]\n",
        "last_modified": "2025-12-25T21:22:14.837271"
      },
      "task_intent": {
        "title": "001-complete-guidelines-rag-pdf-import",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2025-12-25T01:36:12.634652",
  "last_updated": "2025-12-25T01:36:12.647094"
}