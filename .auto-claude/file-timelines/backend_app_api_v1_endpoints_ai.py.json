{
  "file_path": "backend/app/api/v1/endpoints/ai.py",
  "main_branch_history": [],
  "task_views": {
    "001-complete-guidelines-rag-pdf-import": {
      "task_id": "001-complete-guidelines-rag-pdf-import",
      "branch_point": {
        "commit_hash": "d092d181e511c0ef7a36dcfd2dfe3f083cbae73e",
        "content": "",
        "timestamp": "2025-12-25T01:35:52.079046"
      },
      "worktree_state": {
        "content": "from fastapi import APIRouter, HTTPException, Request, File, UploadFile\nfrom pydantic import BaseModel\nfrom backend.services.logger import get_logger\nfrom slowapi import Limiter\nfrom slowapi.util import get_remote_address\nimport os\nimport aiofiles\nfrom pathlib import Path\n\nrouter = APIRouter()\nlogger = get_logger(__name__)\nlimiter = Limiter(key_func=get_remote_address)\n\n# Epicrisis\nclass EpicrisisRequest(BaseModel):\n    items: str\n\n@router.post(\"/epicrisis\")\n@limiter.limit(\"10/minute\")\nasync def epicrisis_endpoint(body: EpicrisisRequest, request: Request):\n    \"\"\"\n    Generates a medical report from raw notes.\n    \"\"\"\n    logger.info(\"Received epicrisis request\", input_length=len(body.items))\n    try:\n        from backend.epicrisis_graph import app as epicrisis_app\n        \n        inputs = {\"raw_input\": body.items}\n        result = await epicrisis_app.ainvoke(inputs)\n        \n        logger.info(\"Epicrisis generated successfully\")\n        return {\n            \"response\": result[\"report_content\"],\n            \"source\": \"claude-3-haiku\"\n        }\n    except Exception as e:\n        logger.error(\"Error processing epicrisis\", error=e)\n        raise HTTPException(status_code=500, detail=str(e))\n\n# Translation\nclass TranslateRequest(BaseModel):\n    text: str\n    language: str = \"Czech\"\n\n@router.post(\"/translate\")\n@limiter.limit(\"20/minute\")\nasync def translate_endpoint(body: TranslateRequest, request: Request):\n    \"\"\"\n    Translates medical text.\n    \"\"\"\n    logger.info(\"Received translation request\", target_language=body.language)\n    try:\n        from backend.translator_graph import app as translator_app\n        \n        inputs = {\"source_text\": body.text, \"target_language\": body.language}\n        result = await translator_app.ainvoke(inputs)\n        \n        logger.info(\"Translation successful\")\n        return {\n            \"response\": result[\"translated_text\"],\n            \"source\": \"claude-3-haiku\"\n        }\n    except Exception as e:\n        logger.error(\"Error processing translation\", error=e)\n        raise HTTPException(status_code=500, detail=str(e))\n\n# Transcription\n@router.post(\"/transcribe\")\nasync def transcribe_endpoint(file: UploadFile = File(...)):\n    \"\"\"\n    Transcribes audio file using Google Gemini 1.5 Pro.\n    \"\"\"\n    logger.info(\"Received transcription request\", filename=file.filename)\n    try:\n        from backend.services.transcription import TranscriptionService\n        \n        # Save temp file\n        temp_dir = Path(\"backend/data/temp_uploads\")\n        temp_dir.mkdir(parents=True, exist_ok=True)\n        temp_path = temp_dir / file.filename\n        \n        async with aiofiles.open(temp_path, 'wb') as out_file:\n            content = await file.read()\n            await out_file.write(content)\n            \n        # Process\n        service = TranscriptionService()\n        transcript = await service.transcribe_audio(temp_path)\n        \n        # Cleanup\n        try:\n            os.remove(temp_path)\n        except Exception as cleanup_err:\n             logger.warning(f\"Failed to cleanup temp file: {temp_path}\", error=cleanup_err)\n            \n        logger.info(\"Transcription successful\")\n        return {\n            \"transcript\": transcript,\n            \"source\": \"gemini-1.5-pro\"\n        }\n    except Exception as e:\n        logger.error(\"Error processing transcription\", error=e)\n        raise HTTPException(status_code=500, detail=str(e))\n",
        "last_modified": "2025-12-25T21:22:14.835798"
      },
      "task_intent": {
        "title": "001-complete-guidelines-rag-pdf-import",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2025-12-25T01:36:12.620448",
  "last_updated": "2025-12-25T01:36:12.633301"
}