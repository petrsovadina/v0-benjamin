{
  "file_path": "backend/epicrisis_graph.py",
  "main_branch_history": [],
  "task_views": {
    "001-complete-guidelines-rag-pdf-import": {
      "task_id": "001-complete-guidelines-rag-pdf-import",
      "branch_point": {
        "commit_hash": "d092d181e511c0ef7a36dcfd2dfe3f083cbae73e",
        "content": "",
        "timestamp": "2025-12-25T01:35:52.079046"
      },
      "worktree_state": {
        "content": "from typing import TypedDict, List\nfrom langchain_core.messages import BaseMessage, HumanMessage\nfrom langgraph.graph import StateGraph, END\nfrom langchain_anthropic import ChatAnthropic\nimport os\nfrom dotenv import load_dotenv\n\n# Load env variables explicitly\nfrom pathlib import Path\nenv_path = Path(__file__).resolve().parents[1] / '.env'\nload_dotenv(dotenv_path=env_path)\n\n# Define State\nclass EpicrisisState(TypedDict):\n    raw_input: str\n    report_content: str\n\n# Define LLM\nllm = ChatAnthropic(\n    model=\"claude-3-haiku-20240307\",\n    temperature=0,\n    api_key=os.getenv(\"ANTHROPIC_API_KEY\")\n)\n\n# Define Node\ndef generate_report_node(state: EpicrisisState):\n    raw_input = state[\"raw_input\"]\n    \n    system_prompt = \"\"\"You are an expert medical scribe assisting a Czech doctor. \n    Your task is to convert raw, unstructured notes into a professional \"Epikr\u00edza\" (Medical Report).\n    \n    Output Format: Markdown.\n    Structure:\n    # Epikr\u00edza\n    ## Nyn\u011bj\u0161\u00ed onemocn\u011bn\u00ed\n    [Content]\n    \n    ## Osobn\u00ed anamn\u00e9za\n    [Content]\n    \n    ## Medikace\n    [Content]\n    \n    ## Fyzik\u00e1ln\u00ed vy\u0161et\u0159en\u00ed\n    [Content]\n    \n    ## Z\u00e1v\u011br a Doporu\u010den\u00ed\n    [Content]\n    \n    Rules:\n    - Use professional Czech medical terminology.\n    - If information is missing, omit the section or state \"Neuv\u00e1d\u00ed se\".\n    - Be concise and factual.\n    \"\"\"\n    \n    messages = [\n        HumanMessage(content=f\"{system_prompt}\\n\\nRaw Notes:\\n{raw_input}\")\n    ]\n    \n    response = llm.invoke(messages)\n    return {\"report_content\": response.content}\n\n# Build Graph\nbuilder = StateGraph(EpicrisisState)\nbuilder.add_node(\"generate\", generate_report_node)\nbuilder.set_entry_point(\"generate\")\nbuilder.add_edge(\"generate\", END)\n\napp = builder.compile()\n",
        "last_modified": "2025-12-25T21:22:15.328102"
      },
      "task_intent": {
        "title": "001-complete-guidelines-rag-pdf-import",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2025-12-25T01:36:13.728360",
  "last_updated": "2025-12-25T01:36:13.740998"
}