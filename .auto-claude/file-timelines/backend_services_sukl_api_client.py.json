{
  "file_path": "backend/services/sukl_api_client.py",
  "main_branch_history": [],
  "task_views": {
    "001-complete-guidelines-rag-pdf-import": {
      "task_id": "001-complete-guidelines-rag-pdf-import",
      "branch_point": {
        "commit_hash": "d092d181e511c0ef7a36dcfd2dfe3f083cbae73e",
        "content": "",
        "timestamp": "2025-12-25T01:35:52.079046"
      },
      "worktree_state": {
        "content": "import os\nimport requests\nimport logging\nfrom typing import Optional, Dict, Any, Union, Tuple\nfrom pathlib import Path\n\nlogger = logging.getLogger(__name__)\n\nclass SuklApiClient:\n    \"\"\"\n    Client for interacting with S\u00daKL API (testapi.sukl.cz).\n    Requires a client certificate for authentication.\n    \"\"\"\n    \n    BASE_URL_TEST = \"https://testapi.sukl.cz\"\n    BASE_URL_PROD = \"https://api.sukl.cz\"\n    \n    def __init__(self, use_test_env: bool = True):\n        self.base_url = self.BASE_URL_TEST if use_test_env else self.BASE_URL_PROD\n        self.cert_path = os.environ.get(\"SUKL_CERT_PATH\")\n        self.cert_pass = os.environ.get(\"SUKL_CERT_PASS\")\n        \n        if not self.cert_path:\n            logger.warning(\"SUKL_CERT_PATH not set. API calls requiring auth will fail.\")\n        \n        # Requests expects cert as a tuple (cert_file, key_file) or a single PEM file containing both.\n        # If it's a .p12, it needs conversion. For now assuming PEM or handled by user.\n        self.cert = self.cert_path\n        \n        # Verify SSL? usually S\u00daKL has valid certs, but test env might need CA bundle.\n        self.verify_ssl = False if use_test_env else True \n\n    def get_public_data(self, endpoint: str) -> Dict[str, Any]:\n        \"\"\"\n        Generic GET wrapper.\n        \"\"\"\n        url = f\"{self.base_url}/{endpoint.lstrip('/')}\"\n        try:\n            # Note: Explicitly disabling verify for testapi if needed\n            response = requests.get(\n                url, \n                cert=self.cert, \n                verify=self.verify_ssl,\n                timeout=10\n            )\n            response.raise_for_status()\n            return response.json()\n        except requests.exceptions.HTTPError as e:\n            logger.error(f\"HTTP Error calling {url}: {e.response.status_code} - {e.response.text}\")\n            raise\n        except Exception as e:\n            logger.error(f\"Error calling {url}: {e}\")\n            raise\n\n    def check_connection(self) -> bool:\n        \"\"\"\n        Probes the API to verify connectivity and auth.\n        \"\"\"\n        try:\n            # Using a harmless endpoint, hopefully root or docs or specific ping\n            # Often /cis/verze or similar\n            self.get_public_data(\"/docs\") \n            return True\n        except Exception:\n            return False\n",
        "last_modified": "2025-12-25T21:22:15.372175"
      },
      "task_intent": {
        "title": "001-complete-guidelines-rag-pdf-import",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2025-12-25T01:36:14.137799",
  "last_updated": "2025-12-25T01:36:14.152121"
}