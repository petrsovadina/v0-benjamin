{
  "integrations_researched": [
    {
      "name": "pytest",
      "type": "library",
      "verified_package": {
        "name": "pytest",
        "install_command": "pip install pytest>=8.0.0",
        "version": ">=8.0.0",
        "verified": true,
        "already_installed": true
      },
      "api_patterns": {
        "imports": [
          "import pytest",
          "from pytest import fixture, mark"
        ],
        "initialization": "# No initialization needed - pytest discovers tests automatically",
        "key_functions": [
          "@pytest.fixture - Create reusable test fixtures",
          "@pytest.mark.parametrize - Parameterized tests",
          "pytest.raises() - Test exception handling",
          "@pytest.fixture(scope='session') - Session-scoped fixtures",
          "yield - Fixture with teardown"
        ],
        "verified_against": "Context7 MCP: /pytest-dev/pytest"
      },
      "configuration": {
        "env_vars": [],
        "config_files": ["pytest.ini", "pyproject.toml", "setup.cfg", "conftest.py"],
        "dependencies": []
      },
      "infrastructure": {
        "requires_docker": false
      },
      "gotchas": [
        "Test files must be named test_*.py or *_test.py",
        "Test functions must start with test_",
        "Fixtures are discovered automatically from conftest.py files",
        "Async fixtures require pytest-asyncio plugin"
      ],
      "research_sources": [
        "Context7 MCP: /pytest-dev/pytest",
        "https://docs.pytest.org/"
      ]
    },
    {
      "name": "pytest-asyncio",
      "type": "library",
      "verified_package": {
        "name": "pytest-asyncio",
        "install_command": "pip install pytest-asyncio>=0.23.0",
        "version": ">=0.23.0",
        "verified": true,
        "already_installed": true
      },
      "api_patterns": {
        "imports": [
          "import pytest",
          "import asyncio"
        ],
        "initialization": "# Configure in pyproject.toml:\n# [tool.pytest.ini_options]\n# asyncio_mode = \"auto\"",
        "key_functions": [
          "@pytest.mark.asyncio - Mark async test functions",
          "@pytest.fixture with async def - Async fixtures",
          "event_loop_policy fixture - Custom event loop"
        ],
        "verified_against": "Context7 MCP: /pytest-dev/pytest-asyncio"
      },
      "configuration": {
        "env_vars": [],
        "config_files": ["pyproject.toml", "pytest.ini"],
        "config_example": {
          "pyproject_toml": "[tool.pytest.ini_options]\nasyncio_mode = \"auto\"\nasyncio_default_fixture_loop_scope = \"function\""
        },
        "dependencies": ["pytest"]
      },
      "infrastructure": {
        "requires_docker": false
      },
      "gotchas": [
        "Use asyncio_mode='auto' to avoid decorating every async test",
        "Default loop scope is 'function' - each test gets its own event loop",
        "In 'auto' mode, @pytest.fixture decorated async functions are treated as asyncio fixtures"
      ],
      "research_sources": [
        "Context7 MCP: /pytest-dev/pytest-asyncio"
      ]
    },
    {
      "name": "pytest-cov",
      "type": "library",
      "verified_package": {
        "name": "pytest-cov",
        "install_command": "pip install pytest-cov",
        "version": "latest",
        "verified": true,
        "already_installed": false
      },
      "api_patterns": {
        "imports": [],
        "initialization": "# No code initialization - used via command line or config",
        "key_functions": [
          "--cov=PATH - Measure coverage for path",
          "--cov-report=type - Report type (term, html, xml, json)",
          "--cov-fail-under=MIN - Fail if coverage < MIN%",
          "--cov-branch - Enable branch coverage"
        ],
        "verified_against": "Context7 MCP: /pytest-dev/pytest-cov"
      },
      "configuration": {
        "env_vars": [],
        "config_files": ["pyproject.toml", ".coveragerc", "setup.cfg"],
        "config_example": {
          "pyproject_toml": "[tool.pytest.ini_options]\naddopts = [\n    \"--cov=backend\",\n    \"--cov-report=term-missing\",\n    \"--cov-report=html:htmlcov\",\n    \"--cov-branch\",\n    \"--cov-fail-under=80\"\n]\n\n[tool.coverage.run]\nbranch = true\nsource = [\"backend\"]\nomit = [\"*/tests/*\", \"*/migrations/*\"]\n\n[tool.coverage.report]\nshow_missing = true\nexclude_lines = [\n    \"pragma: no cover\",\n    \"raise NotImplementedError\"\n]"
        },
        "dependencies": ["pytest", "coverage"]
      },
      "infrastructure": {
        "requires_docker": false
      },
      "gotchas": [
        "Use --cov-report= (empty) to disable default terminal output",
        "Multiple --cov-report options can be combined",
        "Coverage data can be appended across runs with --cov-append"
      ],
      "research_sources": [
        "Context7 MCP: /pytest-dev/pytest-cov"
      ]
    },
    {
      "name": "FastAPI TestClient",
      "type": "library",
      "verified_package": {
        "name": "fastapi",
        "install_command": "pip install fastapi[all]",
        "version": ">=0.110.0",
        "verified": true,
        "already_installed": true
      },
      "api_patterns": {
        "imports": [
          "from fastapi.testclient import TestClient",
          "from httpx import ASGITransport, AsyncClient"
        ],
        "initialization": "client = TestClient(app)",
        "key_functions": [
          "TestClient(app) - Synchronous test client",
          "AsyncClient(transport=ASGITransport(app=app)) - Async test client",
          "client.get(), client.post() - HTTP methods",
          "app.dependency_overrides[dep] = mock_dep - Override dependencies"
        ],
        "verified_against": "Context7 MCP: /websites/fastapi_tiangolo"
      },
      "configuration": {
        "env_vars": [],
        "config_files": [],
        "dependencies": ["httpx", "starlette"]
      },
      "infrastructure": {
        "requires_docker": false
      },
      "gotchas": [
        "TestClient is synchronous - use AsyncClient for async tests",
        "Use dependency_overrides to mock dependencies in tests",
        "Clear dependency_overrides after each test to avoid pollution",
        "For async tests, use pytest.mark.anyio or pytest.mark.asyncio"
      ],
      "research_sources": [
        "Context7 MCP: /websites/fastapi_tiangolo",
        "https://fastapi.tiangolo.com/tutorial/testing/"
      ]
    },
    {
      "name": "Vitest",
      "type": "library",
      "verified_package": {
        "name": "vitest",
        "install_command": "npm install -D vitest @vitest/coverage-v8",
        "version": "latest",
        "verified": true,
        "already_installed": false
      },
      "api_patterns": {
        "imports": [
          "import { expect, test, describe, vi } from 'vitest'",
          "import { render, screen } from '@testing-library/react'"
        ],
        "initialization": "// Add to package.json scripts:\n// \"test\": \"vitest\",\n// \"test:coverage\": \"vitest --coverage\"",
        "key_functions": [
          "test('name', () => {}) - Define test case",
          "describe('suite', () => {}) - Group tests",
          "expect(value).toBe(expected) - Assertions",
          "vi.mock() - Mock modules",
          "vi.fn() - Create mock function"
        ],
        "verified_against": "Context7 MCP: /vitest-dev/vitest"
      },
      "configuration": {
        "env_vars": [],
        "config_files": ["vitest.config.ts", "vitest.config.js"],
        "config_example": {
          "vitest_config_ts": "import { defineConfig } from 'vitest/config'\nimport react from '@vitejs/plugin-react'\n\nexport default defineConfig({\n  plugins: [react()],\n  test: {\n    environment: 'jsdom',\n    globals: true,\n    setupFiles: ['./vitest.setup.ts'],\n    coverage: {\n      provider: 'v8',\n      reporter: ['text', 'html']\n    }\n  }\n})"
        },
        "dependencies": ["@vitejs/plugin-react", "jsdom", "@testing-library/react", "@testing-library/jest-dom"]
      },
      "infrastructure": {
        "requires_docker": false
      },
      "gotchas": [
        "Vitest uses Vite's transform pipeline - compatible with Next.js",
        "Use jsdom environment for React component testing",
        "vi.mock() must be at the top of the file before imports",
        "For React 19, ensure compatibility with testing library versions"
      ],
      "research_sources": [
        "Context7 MCP: /vitest-dev/vitest"
      ]
    },
    {
      "name": "React Testing Library",
      "type": "library",
      "verified_package": {
        "name": "@testing-library/react",
        "install_command": "npm install -D @testing-library/react @testing-library/jest-dom @testing-library/user-event",
        "version": "latest",
        "verified": true,
        "already_installed": false
      },
      "api_patterns": {
        "imports": [
          "import { render, screen, fireEvent, waitFor } from '@testing-library/react'",
          "import userEvent from '@testing-library/user-event'",
          "import '@testing-library/jest-dom'"
        ],
        "initialization": "// In vitest.setup.ts:\nimport '@testing-library/jest-dom'",
        "key_functions": [
          "render(<Component />) - Render component",
          "screen.getByRole(), screen.getByText() - Query elements",
          "screen.findByRole() - Async query (returns promise)",
          "fireEvent.click(element) - Simulate events",
          "userEvent.type(input, 'text') - User-like interactions",
          "waitFor(() => expect(...)) - Wait for async updates"
        ],
        "verified_against": "Context7 MCP: /websites/testing-library"
      },
      "configuration": {
        "env_vars": [],
        "config_files": ["vitest.setup.ts"],
        "dependencies": ["vitest", "jsdom"]
      },
      "infrastructure": {
        "requires_docker": false
      },
      "gotchas": [
        "Prefer getByRole over getByTestId for accessibility",
        "findBy* returns a promise - use for async rendering",
        "userEvent is more realistic than fireEvent",
        "Use waitFor for async state updates",
        "React 19 may require latest testing library version"
      ],
      "research_sources": [
        "Context7 MCP: /websites/testing-library",
        "https://testing-library.com/docs/react-testing-library/intro"
      ]
    },
    {
      "name": "Playwright",
      "type": "library",
      "verified_package": {
        "name": "@playwright/test",
        "install_command": "npm install -D @playwright/test && npx playwright install",
        "version": "latest",
        "verified": true,
        "already_installed": false
      },
      "api_patterns": {
        "imports": [
          "import { test, expect } from '@playwright/test'",
          "import { defineConfig, devices } from '@playwright/test'"
        ],
        "initialization": "// After install, run:\n// npx playwright install\n// to download browser binaries",
        "key_functions": [
          "test('name', async ({ page }) => {}) - Define E2E test",
          "page.goto(url) - Navigate to URL",
          "page.getByRole(), page.getByText() - Locators",
          "page.click(), page.fill() - Actions",
          "expect(page).toHaveURL() - Page assertions",
          "expect(locator).toBeVisible() - Element assertions"
        ],
        "verified_against": "Context7 MCP: /microsoft/playwright"
      },
      "configuration": {
        "env_vars": [],
        "config_files": ["playwright.config.ts"],
        "config_example": {
          "playwright_config_ts": "import { defineConfig, devices } from '@playwright/test'\n\nexport default defineConfig({\n  testDir: './e2e',\n  fullyParallel: true,\n  forbidOnly: !!process.env.CI,\n  retries: process.env.CI ? 2 : 0,\n  workers: process.env.CI ? 1 : undefined,\n  reporter: 'html',\n  use: {\n    baseURL: 'http://localhost:3000',\n    trace: 'on-first-retry'\n  },\n  projects: [\n    {\n      name: 'chromium',\n      use: { ...devices['Desktop Chrome'] }\n    },\n    {\n      name: 'firefox',\n      use: { ...devices['Desktop Firefox'] }\n    },\n    {\n      name: 'webkit',\n      use: { ...devices['Desktop Safari'] }\n    }\n  ],\n  webServer: {\n    command: 'npm run dev',\n    url: 'http://localhost:3000',\n    reuseExistingServer: !process.env.CI\n  }\n})"
        },
        "dependencies": []
      },
      "infrastructure": {
        "requires_docker": false,
        "note": "Browser binaries are downloaded automatically"
      },
      "gotchas": [
        "Run 'npx playwright install' to download browser binaries",
        "Use webServer config to auto-start dev server for tests",
        "Use projects for cross-browser testing",
        "forbidOnly: !!process.env.CI prevents test.only in CI",
        "Trace files help debug failed tests"
      ],
      "research_sources": [
        "Context7 MCP: /microsoft/playwright",
        "https://playwright.dev/docs/intro"
      ]
    },
    {
      "name": "pytest-mock",
      "type": "library",
      "verified_package": {
        "name": "pytest-mock",
        "install_command": "pip install pytest-mock",
        "version": "latest",
        "verified": true,
        "already_installed": false
      },
      "api_patterns": {
        "imports": [
          "# Fixture is auto-injected: mocker"
        ],
        "initialization": "# No initialization needed - use mocker fixture",
        "key_functions": [
          "mocker.patch('module.function') - Patch function",
          "mocker.patch.object(obj, 'method') - Patch object method",
          "mocker.MagicMock() - Create mock object",
          "mock.return_value = value - Set return value",
          "mock.assert_called_once() - Verify call"
        ],
        "verified_against": "Context7 MCP: /pytest-dev/pytest-mock"
      },
      "configuration": {
        "env_vars": [],
        "config_files": [],
        "dependencies": ["pytest", "mock"]
      },
      "infrastructure": {
        "requires_docker": false
      },
      "gotchas": [
        "Patches are automatically cleaned up after each test",
        "Patch where the object is used, not where it's defined",
        "Use AsyncMock for async functions"
      ],
      "research_sources": [
        "Context7 MCP: /pytest-dev/pytest-mock"
      ]
    },
    {
      "name": "Supabase (for testing)",
      "type": "service",
      "verified_package": {
        "name": "supabase",
        "install_command": "pip install supabase",
        "version": ">=2.3.0",
        "verified": true,
        "already_installed": true
      },
      "api_patterns": {
        "imports": [
          "from supabase import create_client, Client"
        ],
        "initialization": "client = create_client(supabase_url, supabase_key)",
        "key_functions": [
          "client.table('table').select('*').execute() - Query",
          "client.table('table').insert({}).execute() - Insert",
          "Use mocks in tests to avoid hitting real database"
        ],
        "verified_against": "Existing codebase"
      },
      "configuration": {
        "env_vars": ["SUPABASE_URL", "SUPABASE_KEY", "SUPABASE_SERVICE_KEY"],
        "config_files": [".env", ".env.test"],
        "dependencies": []
      },
      "infrastructure": {
        "requires_docker": false,
        "note": "For tests, use mocks or Supabase local development setup"
      },
      "gotchas": [
        "Use separate test database or mocks to avoid data pollution",
        "Mock Supabase client in unit tests",
        "Use environment variables for test credentials",
        "Consider using transactions for test isolation"
      ],
      "research_sources": [
        "Existing codebase analysis"
      ]
    }
  ],
  "existing_test_infrastructure": {
    "backend": {
      "framework": "pytest",
      "test_directory": "backend/tests/",
      "existing_tests": [
        "test_admin_endpoints.py",
        "test_api_integration.py",
        "test_guideline_pipeline_e2e.py",
        "test_guidelines_loader.py",
        "test_multiformat_pdf_support.py",
        "test_parsers.py",
        "test_rag_flow_verification.py",
        "test_search_service.py",
        "test_sukl_retriever.py"
      ],
      "patterns_used": [
        "TestClient from FastAPI",
        "pytest fixtures with @pytest.fixture",
        "Mocking with unittest.mock (MagicMock, patch, AsyncMock)",
        "Dependency overrides with app.dependency_overrides"
      ]
    },
    "frontend": {
      "framework": "none",
      "note": "No frontend testing framework currently installed"
    }
  },
  "unverified_claims": [],
  "recommendations": [
    {
      "category": "Backend Testing Enhancements",
      "items": [
        "Add pytest-cov for coverage reporting with 80% minimum threshold",
        "Add pytest-mock for cleaner mocking syntax",
        "Create conftest.py with shared fixtures (mock_supabase, mock_graph_app, etc.)",
        "Add pytest.ini or pyproject.toml configuration for asyncio_mode='auto'"
      ]
    },
    {
      "category": "Frontend Testing Setup",
      "items": [
        "Install Vitest as the unit testing framework (compatible with Next.js)",
        "Install React Testing Library for component testing",
        "Install Playwright for E2E testing across browsers",
        "Create vitest.config.ts with jsdom environment"
      ]
    },
    {
      "category": "Test Organization",
      "items": [
        "Backend: Keep existing backend/tests/ structure",
        "Frontend: Create __tests__/ directories alongside components",
        "E2E: Create e2e/ directory at project root for Playwright tests"
      ]
    },
    {
      "category": "CI/CD Integration",
      "items": [
        "Add test scripts to package.json",
        "Configure GitHub Actions for automated testing",
        "Set up coverage reporting and badge generation"
      ]
    }
  ],
  "package_summary": {
    "backend_existing": [
      "pytest>=8.0.0",
      "pytest-asyncio>=0.23.0"
    ],
    "backend_to_add": [
      "pytest-cov",
      "pytest-mock"
    ],
    "frontend_to_add": [
      "vitest",
      "@vitest/coverage-v8",
      "@vitejs/plugin-react",
      "@testing-library/react",
      "@testing-library/jest-dom",
      "@testing-library/user-event",
      "jsdom",
      "@playwright/test"
    ]
  },
  "context7_libraries_used": [
    "/pytest-dev/pytest",
    "/pytest-dev/pytest-asyncio",
    "/pytest-dev/pytest-cov",
    "/pytest-dev/pytest-mock",
    "/vitest-dev/vitest",
    "/websites/testing-library",
    "/microsoft/playwright",
    "/websites/fastapi_tiangolo"
  ],
  "created_at": "2025-12-26T00:00:00Z"
}
